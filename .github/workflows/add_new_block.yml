name: Add Block to Page1

on:
  workflow_dispatch: # Manually trigger the workflow

jobs:
  add_block_job:
    runs-on: ubuntu-latest
    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: Install Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Add Block to Page1
      env:
        NEW_BLOCK_TEMPLATE: ${{ secrets.NEW_BLOCK_TEMPLATE }}
      run: |
        # Read the current database.js file
        db_contents=$(cat database.js)

        # Add the new block to the "blocks" array in "page1"
        updated_db_contents=$(echo "$db_contents" | jq --argjson new_block "$NEW_BLOCK_TEMPLATE" '.pages.page1.blocks += [$new_block]')

        # Overwrite the database.js file with the updated content
        echo "$updated_db_contents" > database.js

        # Commit the changes
        git config user.name "timmit147"
        git config user.email "timmeeuwsen@hotmail.nl"
        git add database.js
        git commit -m "Add new block to page1 in database.js"
        git push origin HEAD
