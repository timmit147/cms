name: Add Block to Page1

on:
  workflow_dispatch: # Manually trigger the workflow

jobs:
  add_block_job:
    runs-on: ubuntu-latest
    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: Read database.js
      id: read_database
      run: |
        content=$(cat database.js)
        echo "::set-output name=database_content::$content"

    - name: Add Block to Page1
      run: |
        # New block content in YAML-style multi-line string
        new_block_content: |
          {
            "type": "block4",
            "title": "apple",
            "content": "apples en peren"
          }

        # Append the new block to the "blocks" array in "page1"
        updated_content=$(jq '.pages.page1.blocks += ['"$new_block_content"']' <<<"${{ steps.read_database.outputs.database_content }}")

        # Update the database.js file with the updated content
        echo "$updated_content" > database.js

        # Commit the changes
        git config user.name "timmit147"
        git config user.email "timmeeuwsen@hotmail.nl"
        git add database.js
        git commit -m "Add new block to page1 in database.js"
        git push origin HEAD
